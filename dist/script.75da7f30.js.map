{"version":3,"sources":["api/index.js","script.js"],"names":["getProjectById","id","fetch","then","data","json","getData","url","cacheVersion","cacheName","cacheStorage","caches","open","add","getCachedData","err","console","log","cachedData","cachedResponse","match","ok","deleteOldCaches","currentCache","keys","key","isOurCache","substr","delete","roots","document","querySelectorAll","renderWidget","root","template","integrationName","showBranding","fields","wrapper","createElement","classList","map","row","r","name","indexOf","Number","split","substring","sort","el","el2","order","rowDOM","rowImageWrapper","rowContentWrapper","buttonText","find","buttonUrl","i","length","itemDOM","replace","value","link","linkValue","innerHTML","append","brandingDOM","forEach","styles","dataset","style","setProperty","primaryColor","secondaryColor","templateSlug"],"mappings":";;ACAA;;AA+DA;;;AD/DO,MAAMA,cAAc,GAAG,MAAOC,EAAP,IAAc;AAC1C,ACCF,MAAM4B,KAAK,GAAGC,QAAQ,CAACC,gBAAT,CAA0B,wBAA1B,CAAd;ADAE,SAAO7B,KAAK,CAAE,GAAD,0CAA+B,kBAAiBD,EAAG,EAApD,CAAL,CACJE,IADI,CACEC,IAAD,IAAUA,IAAI,CAACC,IAAL,EADX,EAEJF,IAFI,CAEEC,IAAD,IAAU;AACd,ACDN,SAAS4B,EDCI5B,IAAP,MCDN,CAAsB6B,IAAtB,EAA4BC,QAA5B,EAAsCC,eAAtC,EAAuDC,YAAvD,EAAqEC,MAArE,EAA6E;ADExE,ACDH,GDHO,CAAP,ICGMC,OAAO,GAAGR,QAAQ,CAACS,aAAT,CAAuB,KAAvB,CAAhB;ADED,ACDCD,CDNK,CCMLA,OAAO,CAACE,SAAR,CAAkB3B,GAAlB,CAAsBqB,QAAtB;AAEAG,EAAAA,MAAM,CAACI,GAAP,CAAYC,GAAD,IAAS;AAClB,QAAIP,eAAe,KAAK,UAAxB,EAAoC;AAClCO,MAAAA,GAAG,CAACD,GAAJ,CAASE,CAAD,IAAO;ADFrB,ACGQ,YAAIA,CAAC,CAACC,CDHCtC,GCGH,CAAOuC,GDHnB,CAAuBtC,GAAvB,ACGY,CAAe,CDHC,ECGhB,IAAsB,CAAC,CAA3B,EAA8B;ADFpC,ACGQoC,QDHFnC,ECGEmC,CAAC,CAAC,OAAD,CDHS,ACGV,GDHa,ACGAG,CDHrB,KCG2B,CAACH,CAAC,CAACC,IAAF,CAAOG,KAAP,CAAa,GAAb,EAAkB,CAAlB,CAAD,CAAN,IAAgC,EAA7C;ADFR,ACGQJ,QDHFlC,ECGEkC,CAAC,CAAC,KDHK,CCGN,CAAD,CDHW,ECGCA,CAAC,CAACC,IAAF,CAAOI,MDHMxC,GCGb,CAAiB,CAAjB,CAAZ,MDHsC,EAA9C;ACIO;ADHP,ACIK,MDJD,CCDA;ADEF,ACIEkC,MAAAA,GAAG,CDJChC,ECIEgC,GAAG,CAACO,IAAJ,CAAS,CDJC,ACIAC,EAAD,CDJI,CCICC,GAAL,EDJUxC,GCIGuC,EAAE,CDJC,ACIAE,CDJCxC,IAAP,ACIG,CDJSH,ECIE0C,GAAG,CAACC,GDJlB,CAA3B,CCIQ,CAAN;ADHF,ACIEpC,MAAAA,IDJIN,GCIG,CAACO,GAAR,CAAYyB,GAAZ,CDJgB,CAAC7B,GAAb,CAAiBN,GAAjB,CAAN;AACA,ACIC,UDJKH,IAAI,GAAG,MAAMU,aAAa,CAACL,SAAD,EAAYF,GAAZ,CAAhC;AACA,WAAOH,IAAP;AACD,ACIC,GDTF,CAKE,MCIMiD,CDJCtC,GAAP,EAAY,ACIA,GAAGe,QAAQ,CAACS,aAAT,CAAuB,KAAvB,CAAf;ADHAvB,ACIA,IDJAA,MCIMsC,CDJC,CAACrC,GAAR,CAAYF,GAAZ,MCIqB,GAAGe,QAAQ,CAACS,aAAT,CAAuB,KAAvB,CAAxB;ADHA,ACIA,UDJMrB,ACIAqC,UDJU,GAAG,ICII,EDJEzC,CCICgB,QAAQ,CAACS,GDJG,CAAC9B,SAAD,ACIZ,CAAuB,CDJCF,GAAZ,CAAtC,ACI0B,CAA1B;AACA8C,IAAAA,MAAM,CAACb,SAAP,CAAiB3B,GAAjB,CAAqB,MAArB;ADJA,ACKAyC,IAAAA,IDLIpC,UAAJ,CCKe,CDLC,ACKAsB,SAAhB,CAA0B3B,GAA1B,CAA8B,aAA9B;ADJE,ACKF0C,IAAAA,SDLSrC,QCKQ,CAACsB,CDLhB,QCKF,CAA4B3B,GAA5B,CAAgC,eAAhC;ADJC,ACKD,QAAI2C,UAAU,GAAGd,GAAG,CAACe,IAAJ,CAAUP,EAAD,IAAQA,EAAE,CAACN,IAAH,IAAW,aAA5B,CAAjB;ADJD,ACKC,QAAIc,SAAS,GAAGhB,GAAG,CAACe,IAAJ,CAAUP,EAAD,IAAQA,EAAE,CAACN,IAAH,IAAW,YAA5B,CAAhB;ADJH,EAED;ACGI,SAAK,IAAIe,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGjB,GAAG,CAACkB,MAAxB,EAAgCD,CAAC,EAAjC,EAAqC;AACnC,UAAIE,OAAO,GAAG,IAAd;ADHN,ACIMA,MAAAA,OAAO,EDJE/C,CCICgB,QAAQ,CAACS,GDJzB,CAA6B9B,SAA7B,ACIgB,CAAuB,CDJCF,GAAxC,CCIgB,CDJ6B,ACIvC;ADHJ,ACIIsD,MAAAA,EDJEnD,KCIK,CAAC8B,MDJM,GAAG,ACIjB,CAAkB3B,GAAlB,CAAsB6B,CDJC/B,ECIE,CAACgD,CAAD,CAAH,CDJO,ACIAf,CDJChC,GCIR,CDJC,ACIWkD,CDJCrD,MCIb,CAAoB,EDJnB,CAA3B,ACI0B,EAAyB,GAAzB,CAAtB;ADHJ,QAAMU,cAAc,GAAG,MAAMT,YAAY,CAACU,KAAb,CAAmBb,GAAnB,CAA7B;ACKI,UAAImC,GAAG,CAACiB,CAAD,CAAH,CAAOf,IAAP,IAAe,aAAf,IAAgCF,GAAG,CAACiB,CAAD,CAAH,CAAOI,KAA3C,EAAkD;ADHtD,ACIM,MDJF,CAAC5C,OCIO6C,IAAI,GDJZ,ACIetB,GAAG,CDJC,ACIAe,CDJCtC,GCIL,CAAU+B,EAAD,IAAQA,EAAE,CAACN,CDJD,CAACvB,EAAvC,ACIoC,EDJO,ECII,YAA5B,CAAb;ADHJ,ACII,WDJG,CCIC4C,IDJR,KCIiB,GAAG,IAAhB;ADHL;ACIK,YAAID,IAAJ,EAAU;ADFhB,ACGQC,SDHD,CCGCA,KDHK9C,ICGI,GAAG6C,IAAI,CAACD,EDHE,CAAC1D,ECGR,EDHP,EAAb,ACGkC,GAA1B;ADFT,ACGQ,EDDT;;ACEQwD,QAAAA,OAAO,CAACK,SAAR,GAAqB,YAAWD,SAAU,KAAIvB,GAAG,CAACiB,CAAD,CAAH,CAAOI,KAAM,MAA3D;ADDR,ACEQR,QAAAA,ODFOjC,UCEU,CAAC6C,IDF1B,CAA+B5C,CCEvB,CAAyBsC,OAAzB,GDFR,EAA6C;AAC3C,ACEK,OARD,CDMErC,IAAI,CCEC,EDFE,ECEEkB,GAAG,CDFC/B,ACEAgD,CAAD,CAAH,CAAOf,GDFG,CAACpB,ACEX,IDFI,ACEW,EDF9B,UCEW,EAAiC;AACtC;ADDN,ACEK,ODFA,ACAM,MDAAC,ACEA,GDFX,CCEeiB,GDFGlB,ACEA,CAACmC,CAAD,CAAH,CDFf,ACEsBf,EDFE,ECET,IAAe,WAAnB,EAAgC;ADDzC,ACEIiB,QAAAA,EDFEnC,KCEK,CAACwC,IDFI,GAAG,ECEf,GAAqB,cDFazC,GAAG,CAACE,MAAJ,CAAW,CAAX,EAAc,ACEAe,CDFd,CAAtC,CCEuD,CAACiB,CAAD,CAAH,CAAOI,KAAP,IAC9C,2BAA4B,KAD9B;AAEAT,QAAAA,eAAe,CAACa,MAAhB,CAAuBN,OAAvB;ADFJ,ACGG,OAJM,CDCLtC,KCGK,ODHO,KAAKE,GAAjB,IAAwB,CAACC,UAA7B,EAAyC;AACvC,ACGEmC,QAAAA,OAAO,CAACK,SAAR,GAAqB,SAAQxB,GAAG,CAACiB,CAAD,CAAH,CAAOI,KAAM,SAA1C;ADFH,ACGGR,QAAAA,iBAAiB,CAACY,MAAlB,CAAyBN,OAAzB;AACD;ADFHlD,IAAAA,MAAM,CAACiB,MAAP,CAAcH,GAAd;AACD,ACEG4B,MAAAA,MAAM,CAACc,MAAP,CAAcb,eAAd;ADDL,ACEKD,MAAAA,MAAM,CAACc,MAAP,CAAcZ,iBAAd;AACD;;AACDjB,IAAAA,OAAO,CAAC6B,MAAR,CAAed,MAAf;AACD,GA/CD;AAgDApB,EAAAA,IAAI,CAACkC,MAAL,CAAY7B,OAAZ;;AACA,MAAIF,YAAJ,EAAkB;AAChB,UAAMgC,WAAW,GAAGtC,QAAQ,CAACS,aAAT,CAAuB,KAAvB,CAApB;AACA6B,IAAAA,WAAW,CAACF,SAAZ,GAAyB,yNAAzB;AACAjC,IAAAA,IAAI,CAACkC,MAAL,CAAYC,WAAZ;AACD;AACF;;AAGD,CAAC,kBAAiB;AAChBvC,EAAAA,KAAK,CAACwC,OAAN,CAAc,gBAAepC,IAAf,EAAqB;AACjCA,IAAAA,IAAI,CAACiC,SAAL,IAAmB;AACvB,eAAeI,yBAAO;AACtB,OAFI;AAGA,UAAMlE,IAAI,GAAG,MAAM,yBAAe6B,IAAI,CAACsC,OAAL,CAAa,cAAb,CAAf,CAAnB;AACAtC,IAAAA,IAAI,CAACuC,KAAL,CAAWC,WAAX,CAAuB,iBAAvB,EAA0CrE,IAAI,CAACsE,YAA/C;AACAzC,IAAAA,IAAI,CAACuC,KAAL,CAAWC,WAAX,CAAuB,mBAAvB,EAA4CrE,IAAI,CAACuE,cAAjD;AACA3C,IAAAA,YAAY,CACVC,IADU,EAEV7B,IAAI,CAACwE,YAFK,EAGVxE,IAAI,CAAC+B,eAHK,EAIV/B,IAAI,CAACgC,YAJK,EAKVhC,IAAI,CAACiC,MALK,CAAZ;AAOD,GAdD;AAeD,CAhBD","file":"script.75da7f30.js","sourceRoot":"..","sourcesContent":["export const getProjectById = async (id) => {\n  // return await getData();\n  return fetch(`${process.env.LAMBDA_ENDPOINT}/projects/data/${id}`)\n    .then((data) => data.json())\n    .then((data) => {\n      return data;\n    });\n};\nasync function getData(url) {\n  const cacheVersion = 1;\n  const cacheName = `embedtables-${cacheVersion}`;\n  try {\n    const cacheStorage = await caches.open(cacheName);\n    await cacheStorage.add(url);\n    const data = await getCachedData(cacheName, url);\n    return data;\n  } catch (err) {\n    console.log(err);\n    const cachedData = await getCachedData(cacheName, url);\n    if (cachedData) {\n      return cachedData;\n    }\n  }\n}\n\n// Get data from the cache.\nasync function getCachedData(cacheName, url) {\n  const cacheStorage = await caches.open(cacheName);\n  const cachedResponse = await cacheStorage.match(url);\n\n  if (!cachedResponse || !cachedResponse.ok) {\n    return false;\n  }\n\n  return await cachedResponse.json();\n}\n\n// Delete any old caches to respect user's disk space.\nasync function deleteOldCaches(currentCache) {\n  const keys = await caches.keys();\n\n  for (const key of keys) {\n    const isOurCache = \"embedtables-\" === key.substr(0, 6);\n\n    if (currentCache === key || !isOurCache) {\n      continue;\n    }\n\n    caches.delete(key);\n  }\n}\n","import { getProjectById } from \"./api\";\n\nconst roots = document.querySelectorAll(\"div[data-embedtableid]\");\n\nfunction renderWidget(root, template, integrationName, showBranding, fields) {\n  const wrapper = document.createElement(\"div\");\n  wrapper.classList.add(template);\n\n  fields.map((row) => {\n    if (integrationName === \"airtable\") {\n      row.map((r) => {\n        if (r.name.indexOf(\"*\") > -1) {\n          r[\"order\"] = Number(r.name.split(\"*\")[0]) || 99;\n          r[\"name\"] = r.name.substring(2);\n        }\n      });\n      row = row.sort((el, el2) => el.order - el2.order);\n      console.log(row);\n    }\n\n    const rowDOM = document.createElement(\"div\");\n    const rowImageWrapper = document.createElement(\"div\");\n    const rowContentWrapper = document.createElement(\"div\");\n    rowDOM.classList.add(\"item\");\n    rowImageWrapper.classList.add(\"item__image\");\n    rowContentWrapper.classList.add(\"item__content\");\n    let buttonText = row.find((el) => el.name == \"Button_text\");\n    let buttonUrl = row.find((el) => el.name == \"Button_url\");\n    for (let i = 0; i < row.length; i++) {\n      let itemDOM = null;\n      itemDOM = document.createElement(\"div\");\n      itemDOM.classList.add(row[i].name.replace(\" \", \"-\"));\n\n      if (row[i].name == \"Button_text\" && row[i].value) {\n        const link = row.find((el) => el.name == \"Button_url\");\n        let linkValue = null;\n        if (link) {\n          linkValue = link.value || \"/\";\n        }\n        itemDOM.innerHTML = `<a href='${linkValue}'>${row[i].value}</a>`;\n        rowContentWrapper.append(itemDOM);\n      } else if (row[i].name == \"Button_url\") {\n        continue;\n      } else if (row[i].name == \"Image_url\") {\n        itemDOM.innerHTML = `<img loading=\"lazy\" src='${row[i].value ||\n          \"https://picsum.photos/300\"}'/>`;\n        rowImageWrapper.append(itemDOM);\n      } else {\n        itemDOM.innerHTML = `<span>${row[i].value}</span>`;\n        rowContentWrapper.append(itemDOM);\n      }\n      rowDOM.append(rowImageWrapper);\n      rowDOM.append(rowContentWrapper);\n    }\n    wrapper.append(rowDOM);\n  });\n  root.append(wrapper);\n  if (showBranding) {\n    const brandingDOM = document.createElement(\"div\");\n    brandingDOM.innerHTML = `<div class=\"braning-wrapper\"><span class=\"branding\">Made with </span><a href=\"https://embedtables.com\"><img src=\"https://app.embedtables.com/static/media/logo.8fd74efc.svg\" width=\"20px\" alt=\"embedtables\"/></a></div>`;\n    root.append(brandingDOM);\n  }\n}\nimport styles from \"./et-templates-style.css\";\n\n(async function() {\n  roots.forEach(async function(root) {\n    root.innerHTML += `\n      <style>${styles}</style> \n      `;\n    const data = await getProjectById(root.dataset[\"embedtableid\"]);\n    root.style.setProperty(\"--primary-color\", data.primaryColor);\n    root.style.setProperty(\"--secondary-color\", data.secondaryColor);\n    renderWidget(\n      root,\n      data.templateSlug,\n      data.integrationName,\n      data.showBranding,\n      data.fields\n    );\n  });\n})();\n"]}